{"version":3,"file":"forum/components/MessagesPage.js","mappings":"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","sources":["webpack://@flarum/messages/./src/forum/components/DialogListItem.tsx","webpack://@flarum/messages/./src/forum/components/DialogList.tsx","webpack://@flarum/messages/./src/forum/components/MessagesSidebar.tsx","webpack://@flarum/messages/./src/forum/components/Message.tsx","webpack://@flarum/messages/./src/forum/components/MessageStream.tsx","webpack://@flarum/messages/./src/forum/states/MessageStreamState.ts","webpack://@flarum/messages/./src/forum/components/DetailsModal.tsx","webpack://@flarum/messages/./src/forum/components/DialogSection.tsx","webpack://@flarum/messages/./src/forum/components/MessagesPage.tsx"],"sourcesContent":["import Component from 'flarum/common/Component';\nimport classList from 'flarum/common/utils/classList';\nimport Link from 'flarum/common/components/Link';\nimport app from 'flarum/forum/app';\nimport Avatar from 'flarum/common/components/Avatar';\nimport username from 'flarum/common/helpers/username';\nimport humanTime from 'flarum/common/helpers/humanTime';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Button from 'flarum/common/components/Button';\nexport default class DialogListItem extends Component {\n  view(vnode) {\n    const dialog = this.attrs.dialog;\n    const recipient = dialog.recipient();\n    const lastMessage = dialog.lastMessage();\n    return m(\"li\", {\n      className: classList('DialogListItem', {\n        'DialogListItem--unread': dialog.unreadCount(),\n        active: this.attrs.active\n      })\n    }, m(Link, {\n      href: app.route.dialog(dialog),\n      className: classList('DialogListItem-button', {\n        active: this.attrs.active\n      })\n    }, m(\"div\", {\n      className: \"DialogListItem-avatar\"\n    }, m(Avatar, {\n      user: recipient\n    }), !!dialog.unreadCount() && m(\"div\", {\n      className: \"Bubble Bubble--primary\"\n    }, dialog.unreadCount())), m(\"div\", {\n      className: \"DialogListItem-content\"\n    }, m(\"div\", {\n      className: \"DialogListItem-title\"\n    }, username(recipient), humanTime(dialog.lastMessageAt()), this.attrs.actions && m(\"div\", {\n      className: \"DialogListItem-actions\"\n    }, this.actionItems().toArray())), m(\"div\", {\n      className: \"DialogListItem-lastMessage\"\n    }, lastMessage ? lastMessage.contentPlain()?.slice(0, 80) : ''))));\n  }\n  actionItems() {\n    const items = new ItemList();\n    items.add('markAsRead', m(Button, {\n      className: \"Notification-action Button Button--link\",\n      icon: \"fas fa-check\",\n      \"aria-label\": app.translator.trans('flarum-messages.forum.dialog_list.mark_as_read_tooltip'),\n      onclick: e => {\n        e.preventDefault();\n        e.stopPropagation();\n        this.attrs.dialog.save({\n          lastReadMessageId: (this.attrs.dialog.data.relationships?.lastMessage.data).id\n        }).finally(() => {\n          if (this.attrs.dialog.unreadCount() === 0) {\n            app.session.user.pushAttributes({\n              messageCount: (app.session.user.attribute('messageCount') ?? 1) - 1\n            });\n          }\n          m.redraw();\n        });\n      }\n    }), 100);\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogListItem', DialogListItem);","import app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport DialogListItem from './DialogListItem';\nexport default class DialogList extends Component {\n  oninit(vnode) {\n    super.oninit(vnode);\n  }\n  oncreate(vnode) {\n    super.oncreate(vnode);\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n  }\n  view() {\n    return m(\"div\", {\n      className: \"DialogList\"\n    }, m(\"ul\", {\n      className: \"DialogList-list\"\n    }, this.attrs.state.getAllItems().map(dialog => m(DialogListItem, {\n      dialog: dialog,\n      active: this.attrs.activeDialog?.id() === dialog.id(),\n      actions: this.attrs.itemActions\n    }))), this.attrs.state.hasNext() && !this.attrs.hideMore && m(\"div\", {\n      className: \"DialogList-loadMore\"\n    }, m(Button, {\n      className: \"Button\",\n      onclick: this.attrs.state.loadNext.bind(this.attrs.state)\n    }, app.translator.trans('flarum-messages.forum.dialog_list.load_more_button'))));\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogList', DialogList);","import app from 'flarum/forum/app';\nimport IndexSidebar from 'flarum/forum/components/IndexSidebar';\nimport Button from 'flarum/common/components/Button';\nexport default class MessagesSidebar extends IndexSidebar {\n  static initAttrs(attrs) {\n    attrs.className = 'MessagesPage-nav';\n  }\n  items() {\n    const items = super.items();\n    items.remove('newDiscussion');\n    items.add('newMessage', m(Button, {\n      icon: \"fas fa-edit\",\n      className: \"Button Button--primary IndexPage-newDiscussion MessagesPage-newMessage\",\n      itemClassName: \"App-primaryControl\",\n      onclick: () => {\n        return this.newMessageAction();\n      },\n      disabled: !app.session.user.canSendAnyMessage()\n    }, app.session.user.canSendAnyMessage() ? app.translator.trans('flarum-messages.forum.messages_page.send_message_button') : app.translator.trans('flarum-messages.forum.messages_page.cannot_send_message_button')), 10);\n    return items;\n  }\n\n  /**\n   * Open the composer for a new message.\n   */\n  newMessageAction() {\n    return flarum.reg.asyncModuleImport('flarum/forum/components/ComposerBody').then(() => {\n      app.composer.load(() => import(/* webpackChunkName: 'forum/components/MessageComposer', webpackMode: 'lazy-once' */ './MessageComposer'), {\n        user: app.session.user,\n        onsubmit: () => {\n          app.dialogs.refresh();\n        }\n      }).then(() => app.composer.show());\n      return app.composer;\n    });\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/MessagesSidebar', MessagesSidebar);flarum.reg.addChunkModule('451', '761', 'flarum-messages', 'forum/components/MessageComposer');","import app from 'flarum/forum/app';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport AbstractPost from 'flarum/forum/components/AbstractPost';\nimport Avatar from 'flarum/common/components/Avatar';\nimport Comment from 'flarum/forum/components/Comment';\nimport PostUser from 'flarum/forum/components/PostUser';\nimport PostMeta from 'flarum/forum/components/PostMeta';\nimport classList from 'flarum/common/utils/classList';\n/**\n * The `Post` component displays a single post. The basic post template just\n * includes a controls dropdown; subclasses must implement `content` and `attrs`\n * methods.\n */\nexport default class Message extends AbstractPost {\n  oninit(vnode) {\n    super.oninit(vnode);\n  }\n  user() {\n    return this.attrs.message.user();\n  }\n  controls() {\n    return [];\n  }\n  freshness() {\n    return this.attrs.message.freshness;\n  }\n  createdByStarter() {\n    return false;\n  }\n  onbeforeupdate(vnode) {\n    return super.onbeforeupdate(vnode);\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n  }\n  elementAttrs() {\n    const message = this.attrs.message;\n    const attrs = super.elementAttrs();\n    attrs.className = classList(attrs.className || null, 'Message', {\n      'Post--renderFailed': message.renderFailed(),\n      revealContent: false,\n      editing: false\n    });\n    return attrs;\n  }\n  header() {\n    return super.header();\n  }\n  content() {\n    return super.content().concat([m(Comment, {\n      headerItems: this.headerItems(),\n      cardVisible: false,\n      isEditing: false,\n      isHidden: false,\n      contentHtml: this.attrs.message.contentHtml(),\n      user: this.attrs.message.user()\n    })]);\n  }\n  classes(existing) {\n    return super.classes(existing);\n  }\n  actionItems() {\n    return super.actionItems();\n  }\n  footerItems() {\n    return super.footerItems();\n  }\n  sideItems() {\n    return super.sideItems();\n  }\n  avatar() {\n    return this.attrs.message.user() ? m(Avatar, {\n      user: this.attrs.message.user(),\n      className: \"Post-avatar\"\n    }) : '';\n  }\n  headerItems() {\n    const items = new ItemList();\n    const message = this.attrs.message;\n    items.add('user', m(PostUser, {\n      post: message\n    }), 100);\n    items.add('meta', m(PostMeta, {\n      post: message,\n      permalink: () => {\n        const dialog = message.dialog();\n        if (!dialog) {\n          return null;\n        }\n        return app.forum.attribute('baseOrigin') + app.route.dialog(dialog, message.number());\n      }\n    }));\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/Message', Message);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from 'flarum/forum/app';\nimport Component from 'flarum/common/Component';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Stream from 'flarum/common/utils/Stream';\nimport Button from 'flarum/common/components/Button';\nimport ScrollListener from 'flarum/common/utils/ScrollListener';\nimport Message from './Message';\nexport default class MessageStream extends Component {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"replyPlaceholderComponent\", Stream(null));\n    _defineProperty(this, \"loadingPostComponent\", Stream(null));\n    _defineProperty(this, \"scrollListener\", void 0);\n    _defineProperty(this, \"initialToBottomScroll\", false);\n    _defineProperty(this, \"lastTime\", null);\n    _defineProperty(this, \"checkedRead\", false);\n    _defineProperty(this, \"markingAsRead\", false);\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n\n    // We need the lazy ReplyPlaceholder and LoadingPost components to be loaded.\n    Promise.all([flarum.reg.asyncModuleImport('flarum/forum/components/ReplyPlaceholder'), flarum.reg.asyncModuleImport('flarum/forum/components/LoadingPost')]).then(_ref => {\n      let [ReplyPlaceholder, LoadingPost] = _ref;\n      this.replyPlaceholderComponent(ReplyPlaceholder.default);\n      this.loadingPostComponent(LoadingPost.default);\n    });\n  }\n  oncreate(vnode) {\n    super.oncreate(vnode);\n    this.scrollListener = new ScrollListener(this.onscroll.bind(this), this.element);\n    setTimeout(() => {\n      this.scrollListener.start();\n      this.element.addEventListener('scrollend', this.markAsRead.bind(this));\n    });\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n\n    // @todo: for future versions, consider using the post stream scrubber to scroll through the messages. (big task..)\n    // @todo: introduce read status, to jump to the first unread message instead.\n    if (!this.initialToBottomScroll && !this.attrs.state.isLoading()) {\n      this.scrollToBottom();\n      this.initialToBottomScroll = true;\n    }\n    if (this.initialToBottomScroll && !this.checkedRead) {\n      this.markAsRead();\n      this.checkedRead = true;\n    }\n  }\n  onremove(vnode) {\n    super.onremove(vnode);\n    this.scrollListener.stop();\n  }\n  view() {\n    return m(\"div\", {\n      className: \"MessageStream\"\n    }, this.attrs.state.isLoading() ? m(LoadingIndicator, null) : this.content());\n  }\n  content() {\n    const items = [];\n    const messages = Array.from(new Map(this.attrs.state.getAllItems().map(msg => [msg.id(), msg])).values()).sort((a, b) => a.number() - b.number());\n    const ReplyPlaceholder = this.replyPlaceholderComponent();\n    const LoadingPost = this.loadingPostComponent();\n    if (messages[0].id() !== (this.attrs.dialog.data.relationships?.firstMessage.data).id) {\n      items.push(m(\"div\", {\n        className: \"MessageStream-item\",\n        key: \"loadNext\"\n      }, m(Button, {\n        onclick: () => this.whileMaintainingScroll(() => this.attrs.state.loadNext()),\n        type: \"button\",\n        className: \"Button Button--block MessageStream-loadNext\"\n      }, app.translator.trans('flarum-messages.forum.messages_page.stream.load_previous_button'))));\n      if (LoadingPost) {\n        items.push(m(\"div\", {\n          className: \"MessageStream-item\",\n          key: \"loading-next\"\n        }, m(LoadingPost, null)));\n      }\n    }\n    messages.forEach((message, index) => items.push(this.messageItem(message, index)));\n    if (messages[messages.length - 1].id() !== (this.attrs.dialog.data.relationships?.lastMessage.data).id) {\n      if (LoadingPost) {\n        items.push(m(\"div\", {\n          className: \"MessageStream-item\",\n          key: \"loading-prev\"\n        }, m(LoadingPost, null)));\n      }\n      items.push(m(\"div\", {\n        className: \"MessageStream-item\",\n        key: \"loadPrev\"\n      }, m(Button, {\n        onclick: () => this.whileMaintainingScroll(() => this.attrs.state.loadPrev()),\n        type: \"button\",\n        className: \"Button Button--block MessageStream-loadPrev\"\n      }, app.translator.trans('flarum-messages.forum.messages_page.stream.load_next_button'))));\n    }\n    if (app.session.user.canSendAnyMessage() && ReplyPlaceholder) {\n      items.push(m(\"div\", {\n        className: \"MessageStream-item\",\n        key: \"reply\"\n      }, m(ReplyPlaceholder, {\n        discussion: this.attrs.dialog,\n        onclick: () => {\n          flarum.reg.asyncModuleImport('flarum/forum/components/ComposerBody').then(() => {\n            app.composer.load(() => import(/* webpackChunkName: 'forum/components/MessageComposer', webpackMode: 'lazy-once' */ './MessageComposer'), {\n              user: app.session.user,\n              replyingTo: this.attrs.dialog,\n              onsubmit: () => {\n                this.attrs.state.refresh().then(() => setTimeout(() => this.scrollToBottom(), 50));\n              }\n            }).then(() => app.composer.show());\n          });\n        },\n        composingReply: () => app.composer.composingMessageTo(this.attrs.dialog)\n      })));\n    }\n    return items;\n  }\n  messageItem(message, index) {\n    return m(\"div\", {\n      className: \"MessageStream-item\",\n      key: index,\n      \"data-id\": message.id(),\n      \"data-number\": message.number()\n    }, this.timeGap(message), m(Message, {\n      message: message\n    }));\n  }\n  timeGap(message) {\n    if (message.id() === (this.attrs.dialog.data.relationships?.firstMessage.data).id) {\n      this.lastTime = message.createdAt();\n      return m(\"div\", {\n        class: \"PostStream-timeGap\"\n      }, m(\"span\", null, app.translator.trans('flarum-messages.forum.messages_page.stream.start_of_the_conversation')));\n    }\n    const lastTime = this.lastTime;\n    const dt = message.createdAt().getTime() - (lastTime?.getTime() || 0);\n    this.lastTime = message.createdAt();\n    if (lastTime && dt > 1000 * 60 * 60 * 24 * 4) {\n      return m(\"div\", {\n        className: \"PostStream-timeGap\"\n      }, m(\"span\", null, app.translator.trans('flarum-messages.forum.messages_page.stream.time_lapsed_text', {\n        period: dayjs().add(dt, 'ms').fromNow(true)\n      })));\n    }\n    return null;\n  }\n  onscroll() {\n    this.whileMaintainingScroll(() => {\n      if (this.element.scrollTop <= 80 && this.attrs.state.hasNext()) {\n        return this.attrs.state.loadNext();\n      }\n      if (this.element.scrollTop + this.element.clientHeight >= this.element.scrollHeight && this.attrs.state.hasPrev()) {\n        return this.attrs.state.loadPrev();\n      }\n      return null;\n    });\n  }\n  scrollToBottom() {\n    const near = m.route.param('near');\n    if (near) {\n      const $message = this.element.querySelector(`.MessageStream-item[data-number=\"${near}\"]`);\n      if ($message) {\n        this.element.scrollTop = $message.getBoundingClientRect().top - this.element.getBoundingClientRect().top;\n        $message.classList.add('flash');\n\n        // forget near\n        window.history.replaceState(null, '', app.route.dialog(this.attrs.dialog));\n      } else {\n        this.element.scrollTop = this.element.scrollHeight;\n      }\n    } else {\n      this.element.scrollTop = this.element.scrollHeight;\n    }\n  }\n  whileMaintainingScroll(callback) {\n    const scrollTop = this.element.scrollTop;\n    const scrollHeight = this.element.scrollHeight;\n    const closerToBottomThanTop = scrollTop > (scrollHeight - this.element.clientHeight) / 2;\n    const result = callback();\n    if (result instanceof Promise && !closerToBottomThanTop) {\n      result.then(() => {\n        requestAnimationFrame(() => {\n          this.element.scrollTop = this.element.scrollHeight - scrollHeight + scrollTop;\n        });\n      });\n    }\n  }\n  markAsRead() {\n    const lastVisibleId = Number(this.$('.MessageStream-item[data-id]').filter((_, $el) => {\n      if (this.element.scrollHeight <= this.element.clientHeight) {\n        return true;\n      }\n      return this.$().offset().top + this.element.clientHeight > $($el).offset().top;\n    }).last().data('id'));\n    if (lastVisibleId && app.session.user && lastVisibleId > (this.attrs.dialog.lastReadMessageId() || 0) && !this.markingAsRead) {\n      this.markingAsRead = true;\n      this.attrs.dialog.save({\n        lastReadMessageId: lastVisibleId\n      }).finally(() => {\n        this.markingAsRead = false;\n        if (this.attrs.dialog.unreadCount() === 0) {\n          app.session.user.pushAttributes({\n            messageCount: (app.session.user.attribute('messageCount') ?? 1) - 1\n          });\n        }\n        m.redraw();\n      });\n    }\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/MessageStream', MessageStream);","import PaginatedListState from 'flarum/common/states/PaginatedListState';\nexport default class MessageStreamState extends PaginatedListState {\n  constructor(params, page) {\n    if (page === void 0) {\n      page = 1;\n    }\n    super(params, page, null);\n  }\n  get type() {\n    return 'dialog-messages';\n  }\n  getAllItems() {\n    return super.getAllItems();\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/states/MessageStreamState', MessageStreamState);","import app from 'flarum/forum/app';\nimport Modal from 'flarum/common/components/Modal';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Avatar from 'flarum/common/components/Avatar';\nimport fullTime from 'flarum/common/helpers/fullTime';\nimport username from 'flarum/common/helpers/username';\nimport Link from 'flarum/common/components/Link';\nimport listItems from 'flarum/common/helpers/listItems';\nexport default class DetailsModal extends Modal {\n  className() {\n    return 'Modal--small Modal--flat DetailsModal';\n  }\n  title() {\n    return app.translator.trans('flarum-messages.forum.dialog_section.details_modal.title');\n  }\n  content() {\n    let recipients = (this.attrs.dialog.users() || []).filter(Boolean);\n    return m(\"div\", {\n      className: \"Modal-body DetailsModal-infoGroups\"\n    }, m(\"div\", {\n      className: \"DetailsModal-recipients DetailsModal-info\"\n    }, m(\"div\", {\n      className: \"DetailsModal-info-title\"\n    }, app.translator.trans('flarum-messages.forum.dialog_section.details_modal.recipients')), m(\"div\", {\n      className: \"DetailsModal-recipients-list\"\n    }, recipients?.map(recipient => {\n      return m(\"div\", {\n        className: \"DetailsModal-recipient\"\n      }, m(Avatar, {\n        user: recipient\n      }), m(Link, {\n        href: app.route('user', {\n          username: recipient.slug()\n        })\n      }, m(\"span\", {\n        className: \"DetailsModal-recipient-username\"\n      }, username(recipient))), m(\"div\", {\n        className: \"badges\"\n      }, listItems(recipient.badges().toArray())));\n    }))), this.infoItems().toArray());\n  }\n  infoItems() {\n    const items = new ItemList();\n    items.add('created', m(\"div\", {\n      className: \"DetailsModal-createdAt DetailsModal-info\"\n    }, m(\"div\", {\n      className: \"DetailsModal-info-title\"\n    }, app.translator.trans('flarum-messages.forum.dialog_section.details_modal.created_at')), m(\"div\", {\n      className: \"DetailsModal-info-content\"\n    }, fullTime(this.attrs.dialog.createdAt()))));\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DetailsModal', DetailsModal);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport Component from 'flarum/common/Component';\nimport MessageStream from './MessageStream';\nimport username from 'flarum/common/helpers/username';\nimport MessageStreamState from '../states/MessageStreamState';\nimport Avatar from 'flarum/common/components/Avatar';\nimport Link from 'flarum/common/components/Link';\nimport app from 'flarum/forum/app';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Button from 'flarum/common/components/Button';\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport DetailsModal from './DetailsModal';\nimport listItems from 'flarum/common/helpers/listItems';\nexport default class DialogSection extends Component {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"loading\", false);\n    _defineProperty(this, \"messages\", void 0);\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.messages = new MessageStreamState(this.requestParams());\n    this.messages.refresh();\n  }\n  requestParams(forgetNear) {\n    if (forgetNear === void 0) {\n      forgetNear = false;\n    }\n    const params = {\n      filter: {\n        dialog: this.attrs.dialog.id()\n      },\n      sort: '-number'\n    };\n    const near = m.route.param('near');\n    if (near && !forgetNear) {\n      params.page = params.page || {};\n      params.page.near = parseInt(near);\n    }\n    return params;\n  }\n  view() {\n    const recipient = this.attrs.dialog.recipient();\n    return m(\"div\", {\n      className: \"DialogSection\"\n    }, m(\"div\", {\n      className: \"DialogSection-header\"\n    }, m(Avatar, {\n      user: recipient\n    }), m(\"div\", {\n      className: \"DialogSection-header-info\"\n    }, m(\"h2\", {\n      className: \"DialogSection-header-info-title\"\n    }, recipient && m(Link, {\n      href: app.route.user(recipient)\n    }, username(recipient)) || username(recipient), recipient && recipient.canSendAnyMessage() ? null : m(\"span\", {\n      className: \"DialogSection-header-info-helperText\"\n    }, app.translator.trans('flarum-messages.forum.dialog_section.cannot_reply_text'))), m(\"div\", {\n      className: \"badges\"\n    }, listItems(recipient?.badges().toArray() || []))), m(\"div\", {\n      className: \"DialogSection-header-actions\"\n    }, this.actionItems().toArray())), m(MessageStream, {\n      dialog: this.attrs.dialog,\n      state: this.messages\n    }));\n  }\n  actionItems() {\n    const items = new ItemList();\n    items.add('back', m(Button, {\n      className: \"Button Button--icon DialogSection-back\",\n      icon: \"fas fa-arrow-left\",\n      onclick: this.attrs.onback\n    }, app.translator.trans('flarum-messages.forum.dialog_section.back_label')));\n    items.add('details', m(Dropdown, {\n      icon: \"fas fa-ellipsis-h\",\n      className: \"DialogSection-controls\",\n      buttonClassName: \"Button Button--icon\",\n      accessibleToggleLabel: app.translator.trans('flarum-messages.forum.dialog_section.controls_toggle_label'),\n      label: app.translator.trans('flarum-messages.forum.dialog_section.controls_toggle_label')\n    }, this.controlItems().toArray()));\n    return items;\n  }\n  controlItems() {\n    const items = new ItemList();\n    items.add('details', m(Button, {\n      icon: \"fas fa-info-circle\",\n      onclick: () => app.modal.show(DetailsModal, {\n        dialog: this.attrs.dialog\n      })\n    }, app.translator.trans('flarum-messages.forum.dialog_section.controls.details_button')));\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/DialogSection', DialogSection);","import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport app from 'flarum/forum/app';\nimport Page from 'flarum/common/components/Page';\nimport PageStructure from 'flarum/forum/components/PageStructure';\nimport Icon from 'flarum/common/components/Icon';\nimport DialogList from './DialogList';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Stream from 'flarum/common/utils/Stream';\nimport InfoTile from 'flarum/common/components/InfoTile';\nimport MessagesSidebar from './MessagesSidebar';\nimport DialogSection from './DialogSection';\nimport listItems from 'flarum/common/helpers/listItems';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport Button from 'flarum/common/components/Button';\nimport classList from 'flarum/common/utils/classList';\nexport default class MessagesPage extends Page {\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"selectedDialog\", Stream(null));\n    _defineProperty(this, \"currentDialogId\", null);\n  }\n  oninit(vnode) {\n    super.oninit(vnode);\n    if (!app.session.user) {\n      m.route.set(app.route('index'));\n      return;\n    }\n    app.current.set('noTagsList', true);\n    if (!app.dialogs.hasItems()) {\n      app.dialogs.refresh().then(async () => {\n        if (app.dialogs.hasItems()) {\n          await this.initDialog();\n        }\n      });\n    } else {\n      this.initDialog();\n    }\n  }\n  dialogRequestParams() {\n    return {\n      include: 'users.groups'\n    };\n  }\n  async initDialog() {\n    const dialogId = m.route.param('id');\n    this.currentDialogId = dialogId;\n    const title = app.translator.trans('flarum-messages.forum.messages_page.title', {}, true);\n    let dialog;\n    if (dialogId) {\n      dialog = app.store.getById('dialogs', dialogId) || (await app.store.find('dialogs', dialogId, this.dialogRequestParams()));\n    } else {\n      dialog = app.dialogs.getAllItems()[0];\n    }\n    this.selectedDialog(dialog);\n    if (dialog) {\n      app.setTitle(dialog.title());\n      app.history.push('dialog', dialog.title());\n    } else {\n      app.setTitle(title);\n      app.history.push('messages', title);\n    }\n    m.redraw();\n  }\n  onupdate(vnode) {\n    super.onupdate(vnode);\n\n    // Scroll the dialog list to the active dialog item if present and not visible.\n    const dialogElement = this.element.querySelector('.DialogListItem.active');\n    const container = this.element.querySelector('.DialogList');\n    if (dialogElement && $(container).offset().top + container.clientHeight <= $(dialogElement).offset().top) {\n      dialogElement.scrollIntoView();\n    }\n  }\n  view() {\n    return m(PageStructure, {\n      className: \"MessagesPage Page--vertical\",\n      loading: false,\n      hero: this.hero.bind(this),\n      sidebar: () => m(MessagesSidebar, null)\n    }, app.dialogs.isLoading() ? m(LoadingIndicator, null) : !app.dialogs.hasItems() ? m(InfoTile, {\n      icon: \"far fa-envelope-open\"\n    }, app.translator.trans('flarum-messages.forum.messages_page.empty_text')) : m(\"div\", {\n      className: classList('MessagesPage-content', {\n        'MessagesPage-content--onDialog': this.currentDialogId\n      })\n    }, m(\"div\", {\n      className: \"MessagesPage-sidebar\",\n      key: \"sidebar\"\n    }, m(\"div\", {\n      className: \"IndexPage-toolbar\",\n      key: \"toolbar\"\n    }, m(\"ul\", {\n      className: \"IndexPage-toolbar-view\"\n    }, listItems(this.viewItems().toArray())), m(\"ul\", {\n      className: \"IndexPage-toolbar-action\"\n    }, listItems(this.actionItems().toArray()))), m(DialogList, {\n      key: \"list\",\n      state: app.dialogs,\n      activeDialog: this.selectedDialog()\n    })), this.selectedDialog() ? m(DialogSection, {\n      key: \"dialog\",\n      dialog: this.selectedDialog(),\n      onback: () => {\n        this.currentDialogId = null;\n      }\n    }) : m(LoadingIndicator, {\n      key: \"loading\",\n      display: \"block\"\n    })));\n  }\n  hero() {\n    return m(\"header\", {\n      className: \"Hero MessagesPageHero\"\n    }, m(\"div\", {\n      className: \"container\"\n    }, m(\"div\", {\n      className: \"containerNarrow\"\n    }, m(\"h1\", {\n      className: \"Hero-title\"\n    }, m(Icon, {\n      name: \"fas fa-envelope\"\n    }), \" \", app.translator.trans('flarum-messages.forum.messages_page.hero.title')), m(\"div\", {\n      className: \"Hero-subtitle\"\n    }, app.translator.trans('flarum-messages.forum.messages_page.hero.subtitle')))));\n  }\n\n  /**\n   * Build an item list for the part of the toolbar which is concerned with how\n   * the results are displayed. By default this is just a select box to change\n   * the way discussions are sorted.\n   */\n  viewItems() {\n    const items = new ItemList();\n    const sortMap = app.dialogs.sortMap();\n    const sortOptions = Object.keys(sortMap).reduce((acc, sortId) => {\n      const sort = sortMap[sortId];\n      acc[sortId] = typeof sort !== 'string' ? sort.label : app.translator.trans(`flarum-messages.forum.index_sort.${sortId}_button`);\n      return acc;\n    }, {});\n    items.add('sort', m(Dropdown, {\n      buttonClassName: \"Button\",\n      label: sortOptions[app.dialogs.getParams()?.sort || 0] || Object.values(sortOptions)[0],\n      accessibleToggleLabel: app.translator.trans('core.forum.index_sort.toggle_dropdown_accessible_label')\n    }, Object.keys(sortOptions).map(value => {\n      const label = sortOptions[value];\n      const active = (app.dialogs.getParams().sort || Object.keys(sortMap)[0]) === value;\n      return m(Button, {\n        icon: active ? 'fas fa-check' : true,\n        onclick: () => app.dialogs.changeSort(value),\n        active: active\n      }, label);\n    })));\n    return items;\n  }\n\n  /**\n   * Build an item list for the part of the toolbar which is about taking action\n   * on the results. By default this is just a \"mark all as read\" button.\n   */\n  actionItems() {\n    const items = new ItemList();\n    items.add('refresh', m(Button, {\n      title: app.translator.trans('flarum-messages.forum.messages_page.refresh_tooltip'),\n      \"aria-label\": app.translator.trans('flarum-messages.forum.messages_page.refresh_tooltip'),\n      icon: \"fas fa-sync\",\n      className: \"Button Button--icon\",\n      onclick: () => {\n        app.dialogs.refresh();\n      }\n    }));\n    if (app.session.user) {\n      items.add('markAllAsRead', m(Button, {\n        title: app.translator.trans('flarum-messages.forum.messages_page.mark_all_as_read_tooltip'),\n        \"aria-label\": app.translator.trans('flarum-messages.forum.messages_page.mark_all_as_read_tooltip'),\n        icon: \"fas fa-check\",\n        className: \"Button Button--icon\",\n        onclick: () => app.dialogs.markAllAsRead()\n      }));\n    }\n    return items;\n  }\n}\nflarum.reg.add('flarum-messages', 'forum/components/MessagesPage', MessagesPage);"],"names":["DialogListItem","view","vnode","dialog","this","attrs","recipient","lastMessage","m","className","unreadCount","active","href","user","lastMessageAt","actions","actionItems","toArray","contentPlain","slice","items","add","icon","trans","onclick","e","preventDefault","stopPropagation","save","lastReadMessageId","data","relationships","id","finally","pushAttributes","messageCount","attribute","redraw","flarum","reg","DialogList","oninit","super","oncreate","onupdate","state","getAllItems","map","activeDialog","itemActions","hasNext","hideMore","loadNext","bind","MessagesSidebar","initAttrs","remove","itemClassName","newMessageAction","disabled","canSendAnyMessage","asyncModuleImport","then","load","onsubmit","refresh","show","addChunkModule","Message","message","controls","freshness","createdByStarter","onbeforeupdate","elementAttrs","renderFailed","revealContent","editing","header","content","concat","headerItems","cardVisible","isEditing","isHidden","contentHtml","classes","existing","footerItems","sideItems","avatar","post","permalink","number","MessageStream","constructor","arguments","Promise","all","_ref","ReplyPlaceholder","LoadingPost","replyPlaceholderComponent","default","loadingPostComponent","scrollListener","onscroll","element","setTimeout","start","addEventListener","markAsRead","initialToBottomScroll","isLoading","scrollToBottom","checkedRead","onremove","stop","messages","Array","from","Map","msg","values","sort","a","b","firstMessage","push","key","whileMaintainingScroll","type","forEach","index","messageItem","length","loadPrev","discussion","replyingTo","composingReply","composingMessageTo","timeGap","lastTime","createdAt","class","dt","getTime","period","dayjs","fromNow","scrollTop","clientHeight","scrollHeight","hasPrev","near","route","param","$message","querySelector","getBoundingClientRect","top","classList","window","history","replaceState","callback","closerToBottomThanTop","result","requestAnimationFrame","lastVisibleId","Number","$","filter","_","$el","offset","last","markingAsRead","MessageStreamState","params","page","DetailsModal","title","recipients","users","Boolean","username","slug","badges","infoItems","DialogSection","requestParams","forgetNear","parseInt","onback","buttonClassName","accessibleToggleLabel","label","controlItems","MessagesPage","set","hasItems","initDialog","async","dialogRequestParams","include","dialogId","currentDialogId","getById","find","selectedDialog","dialogElement","container","scrollIntoView","loading","hero","sidebar","viewItems","display","name","sortMap","sortOptions","Object","keys","reduce","acc","sortId","getParams","value","changeSort","markAllAsRead"],"sourceRoot":""}